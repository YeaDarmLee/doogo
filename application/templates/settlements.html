<!-- header -->
{% include './common/header.html' %}

<style>
  .card-body {
    padding: 0.75rem;
  }
  .no-hover {
    pointer-events: none;
  }
</style>

<script>
  $(function() {
    // ì‹œì‘ì¼ ë‹¬ë ¥
    $("#startDate").datepicker({
      dateFormat: "yy-mm-dd",
      changeMonth: true,
      changeYear: true,
      onClose: function(selectedDate) {
        // ì‹œì‘ì¼ ì„ íƒ ì‹œ ì¢…ë£Œì¼ ìµœì†Œê°’ ì œí•œ
        $("#endDate").datepicker("option", "minDate", selectedDate);
      }
    });

    // ì¢…ë£Œì¼ ë‹¬ë ¥
    $("#endDate").datepicker({
      dateFormat: "yy-mm-dd",
      changeMonth: true,
      changeYear: true,
      onClose: function(selectedDate) {
        // ì¢…ë£Œì¼ ì„ íƒ ì‹œ ì‹œì‘ì¼ ìµœëŒ€ê°’ ì œí•œ
        $("#startDate").datepicker("option", "maxDate", selectedDate);
      }
    });

    // ğŸ”¹ ê²€ìƒ‰ ë²„íŠ¼ ë™ì‘ ì¶”ê°€
    $("#btnSearch").on("click", function () {
      const start = $("#startDate").val();
      const end   = $("#endDate").val();
      const qs = $.param({ startDate: start, endDate: end });
      window.location.href = "/settlements/?" + qs;
    });
  });
</script>

<body id="page-top">
  <div id="wrapper">
    {% include './common/sidebar.html' %}

    <div id="content-wrapper" class="d-flex flex-column">
      <div id="content">
        <div class="container-fluid">
          <!-- Page Heading -->
          <h1 class="h3 mb-2 text-gray-800">ê²°ì œ ê¸°ë¡</h1>
          <p class="mb-4">
            ì§€ì •í•œ ë‚ ì§œ ì •ë³´ë¡œ ê²°ì œ ê¸°ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.<br>
            ê²°ì œ ê¸°ë¡ì€ ê²°ì œê°€ ì¼ì–´ë‚œ ë‹¤ìŒ ë‚ ë¶€í„° ì¡°íšŒë©ë‹ˆë‹¤. 
          </p>

          <div class="row">

            <!-- ê²°ì œê¸ˆì•¡ í•©ê³„ -->
            <div class="col-4">
              <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-s font-weight-bold text-uppercase mb-1">
                        ê²°ì œê¸ˆì•¡ í•©ê³„
                      </div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800">
                        {{ "{:,.0f}".format(totals.amount) }}ì›
                      </div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ìˆ˜ìˆ˜ë£Œ í•©ê³„ -->
            <div class="col-4">
              <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-s font-weight-bold text-uppercase mb-1">
                        ìˆ˜ìˆ˜ë£Œ í•©ê³„
                      </div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800">
                        {{ "{:,.0f}".format(totals.fee) }}ì›
                      </div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ì§€ê¸‰ì•¡ í•©ê³„ -->
            <div class="col-4">
              <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-s font-weight-bold text-uppercase mb-1">
                        ì§€ê¸‰ì•¡ í•©ê³„
                      </div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800">
                        {{ "{:,.0f}".format(totals.payout) }}ì›
                      </div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
          
          <!-- ë¦¬ìŠ¤íŠ¸ ì¹´ë“œ -->
          <div class="card shadow mt-4">
            <div class="card-header py-3 d-sm-flex align-items-center">
              <h6 class="m-0 font-weight-bold text-primary">ê²°ì œ ëª©ë¡</h6>
              
              <input type="text" class="form-control form-control-user ml-2"
                id="startDate" name="startDate"
                value="{{ startDate }}" placeholder="ì‹œì‘ì¼"
                style="width: 120px;">
              &nbsp;~&nbsp;
              <input type="text" class="form-control form-control-user"
                id="endDate" name="endDate"
                value="{{ endDate }}" placeholder="ì¢…ë£Œì¼"
                style="width: 120px;">

                <a id="btnSearch" class="d-sm-inline-block btn btn-sm btn-primary shadow-sm ml-2" href="javascript:#">ê²€ìƒ‰</a>
            </div>

            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-bordered text-center" id="dataTable" width="100%" cellspacing="0">
                  <thead>
                    <tr>
                      <th>No</th>
                      <th>MID</th>
                      <th>ì£¼ë¬¸ID</th>
                      <th>ê²°ì œìˆ˜ë‹¨</th>
                      <th>ìŠ¹ì¸ì¼ì‹œ</th>
                      <th>ê²°ì œê¸ˆì•¡</th>
                      <th>ìˆ˜ìˆ˜ë£Œ</th>
                      <th>ì§€ê¸‰ì•¡</th>
                      <th>ì •ì‚°ë§¤ì¶œì¼</th>
                      <th>ì •ì‚°ì˜ˆì •ì¼</th>
                      <th>ìƒíƒœ</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% if items and items|length > 0 %}
                      {% for i in items %}
                        {% set payout = (i.payOutAmount 
                                          if i.payOutAmount is not none 
                                          else (i.amount - i.fee 
                                                if i.amount is not none and i.fee is not none 
                                                else none)) %}
                        {% set status_val = i.settlementStatus 
                                            or (i.transfer.settlementStatus if i.transfer else none)
                                            or (i.mobilePhone.settlementStatus if i.mobilePhone else none)
                                            or (i.virtualAccount.settlementStatus if i.virtualAccount else none) %}
                        {% if i.cancel %}
                          {% set status_val = i.cancel.cancelStatus or status_val %}
                        {% endif %}
                
                        <tr>
                          <td>{{ loop.index }}</td>
                          <td>{{ i.mId or '-' }}</td>
                          <td>{{ i.orderId or '-' }}</td>
                
                          <td>{{ i.method or '-' }}</td>
                          <td>{{ i.approvedAt or '-' }}</td>
                
                          <!-- ê²°ì œê¸ˆì•¡ -->
                          <td>
                            {% if i.amount is number and i.amount > 0 %}
                              <div class="btn-sm btn-info no-hover">{{ "{:,.0f}".format(i.amount) }}ì›</div>
                            {% elif i.amount is number and i.amount < 0 %}
                              <div class="btn-sm btn-danger no-hover">{{ "{:,.0f}".format(i.amount) }}ì›</div>
                            {% elif i.amount is number %}
                              <div class="btn-sm btn-secondary no-hover">0ì›</div>
                            {% else %}-{% endif %}
                          </td>
                
                          <!-- ìˆ˜ìˆ˜ë£Œ -->
                          <td>
                            {% if i.fee is number and i.fee > 0 %}
                              <div class="btn-sm btn-info no-hover">{{ "{:,.0f}".format(i.fee) }}ì›</div>
                            {% elif i.fee is number and i.fee < 0 %}
                              <div class="btn-sm btn-danger no-hover">{{ "{:,.0f}".format(i.fee) }}ì›</div>
                            {% elif i.fee is number %}
                              <div class="btn-sm btn-secondary no-hover">0ì›</div>
                            {% else %}-{% endif %}
                          </td>
                
                          <!-- ì§€ê¸‰ì•¡: payOutAmount ì—†ìœ¼ë©´ amount - fee ë¡œ ê³„ì‚° -->
                          <td>
                            {% if payout is number and payout > 0 %}
                              <div class="btn-sm btn-info no-hover">{{ "{:,.0f}".format(payout) }}ì›</div>
                            {% elif payout is number and payout < 0 %}
                              <div class="btn-sm btn-danger no-hover">{{ "{:,.0f}".format(payout) }}ì›</div>
                            {% elif payout is number %}
                              <div class="btn-sm btn-secondary no-hover">0ì›</div>
                            {% else %}-{% endif %}
                          </td>
                
                          <td>{{ i.soldDate or '-' }}</td>
                          <td>{{ i.paidOutDate or '-' }}</td>
                
                          <!-- ìƒíƒœ: ì·¨ì†Œê°€ ìˆìœ¼ë©´ cancelStatus ìš°ì„ , ì—†ìœ¼ë©´ settlementStatus ê³„ì—´ -->
                          <td>{{ status_val or "ì •ìƒ" }}</td>
                        </tr>
                      {% endfor %}
                    {% else %}
                      <tr>
                        <td colspan="12" class="text-muted py-4">
                          <i class="fas fa-info-circle"></i> ì •ì‚° ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                      </tr>
                    {% endif %}
                  </tbody>
                </table>                
              </div>
              <!-- ì„œë²„ì—ì„œ ëŒ€ê¸°/ë°˜ë ¤ë§Œ ë‚´ë ¤ì£¼ë©´ ë‹¨ìˆœ. í•„ìš” ì‹œ í•„í„° ì¶”ê°€ ê°€ëŠ¥ -->
            </div>
          </div>

        </div>
      </div>

      {% include './common/copyright.html' %}
    </div>
  </div>

  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  {% include './common/footer.html' %}
</body>
